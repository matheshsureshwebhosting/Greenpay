<!DOCTYPE html>
<html lang="en">

<!-- Mirrored from kanakku.dreamguystech.com/template-html/form-basic-inputs.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 02 Feb 2021 23:21:22 GMT -->

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
    <title>Passport-Tatkal</title>

    <!-- Favicon -->
    <link rel="shortcut icon" href="/public/img/favicon.png">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/public/css/bootstrap.min.css">

    <!-- Fontawesome CSS -->
    <link rel="stylesheet" href="/public/plugins/fontawesome/css/fontawesome.min.css">
    <link rel="stylesheet" href="/public/plugins/fontawesome/css/all.min.css">

    <!-- Main CSS -->
    <link rel="stylesheet" href="/public/css/style.css">

    <link rel="stylesheet" href="/public/log/vendor/toaster/toaster/build/toastr.css">
    <script src="/public/log/vendor/jquery/jquery-3.2.1.min.js"></script>
    <script src="/public/log/vendor/toaster/toaster/build/toastr.min.js"></script>
    <script src="/public/js/toaster.js"></script>
</head>

<body>

    <!-- Main Wrapper -->
    <div class="main-wrapper">

        <%- include('partial/header'); %>

        <!-- Page Wrapper -->
        <div class="page-wrapper">
            <div class="content container-fluid">

                <!-- Page Header -->
                <div class="page-header">
                    <div class="row">
                        <div class="col">
                            <h3 class="page-title">Passport Tatkal</h3>
                        </div>
                    </div>
                </div>
                <!-- /Page Header -->

                <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Upload Documents</h5>
                                <div style="float: right;">
                                    <h5 class="card-title">Contact : 9150994655</h5><br>
                                    <h5 class="card-title">Price : Rs 3500</h5>
                                </div>
                            </div>
                            <div class="card-body">
                                <div>
                                    <div class="form-group row">
                                        <label class="col-form-label col-md-2">Name</label>
                                        <div class="col-md-10">
                                            <input type="text" class="form-control" id="name">
                                            <div class="invalid-feedback" id="fbname">
                                                Please provide a valid Name.
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label class="col-form-label col-md-2">Mobile Number</label>
                                        <div class="col-md-10">
                                            <input type="number" class="form-control" id="number">
                                            <div class="invalid-feedback" id="fbnumber">
                                                Please provide a valid Number.
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label class="col-form-label col-md-2">Email Id</label>
                                        <div class="col-md-10">
                                            <input type="email" class="form-control" id="email">
                                            <div class="invalid-feedback" id="fbemail">
                                                Please provide a valid EMail.
                                            </div>
                                        </div>
                                    </div>
                                    

                                    <div class="form-group row">
                                        <label class="col-form-label col-md-2">Aadhar Proof</label>
                                        <div class="col-md-10">
                                            <input class="form-control" type="file" id="aadhar">
                                            <div class="invalid-feedback" id="fbaadhar">
                                                Please provide a valid Aadhar.
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group row">
                                        <label class="col-form-label col-md-2">Election Card</label>
                                        <div class="col-md-10">
                                            <input class="form-control" type="file" id="election">
                                            <div class="invalid-feedback" id="fbelection">
                                                Please provide a valid Election Card.
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group row">
                                        <label class="col-form-label col-md-2">Service Photo ID Card</label>
                                        <div class="col-md-10">
                                            <input class="form-control" type="file" id="id">
                                            <div class="invalid-feedback" id="fbid">
                                                Please provide a valid Id Card.
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label class="col-form-label col-md-2">Certificate Of SC/ST/OBC</label>
                                        <div class="col-md-10">
                                            <input class="form-control" type="file" id="certificate">
                                            <div class="invalid-feedback" id="fbcertificate">
                                                Please provide a valid certificate.
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group row">
                                        <label class="col-form-label col-md-2">Identity Card Of Freedom Fighers</label>
                                        <div class="col-md-10">
                                            <input class="form-control" type="file" id="identity">
                                            <div class="invalid-feedback" id="fbidentity">
                                                Please provide a valid identity.
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label class="col-form-label col-md-2">Arms License</label>
                                        <div class="col-md-10">
                                            <input class="form-control" type="file" id="license">
                                            <div class="invalid-feedback" id="fblicense">
                                                Please provide a valid license.
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label class="col-form-label col-md-2">Ration Card</label>
                                        <div class="col-md-10">
                                            <input class="form-control" type="file" id="ration">
                                            <div class="invalid-feedback" id="fbration">
                                                Please provide a valid Ration Card.
                                            </div>
                                        </div>
                                    </div> <div class="form-group row">
                                        <label class="col-form-label col-md-2">Property Documents</label>
                                        <div class="col-md-10">
                                            <input class="form-control" type="file" id="property">
                                            <div class="invalid-feedback" id="fbproperty">
                                                Please provide a valid Property Documents.
                                            </div>
                                        </div>
                                    </div>
                                    
                                </div> <div class="form-group row">
                                    <label class="col-form-label col-md-2">Pension Documents</label>
                                    <div class="col-md-10">
                                        <input class="form-control" type="file" id="pension">
                                        <div class="invalid-feedback" id="fbpension">
                                            Please provide a valid Pension Documents.
                                        </div>
                                    </div>
                                </div>
                                    <div class="form-group row">
                                        <label class="col-form-label col-md-2">Others</label>
                                        <div class="col-md-10">
                                            <input class="form-control" type="file" id="others" multiple>
                                        </div>
                                    </div>

                                    <div class="form-group row justify-content-center">
                                        <button type="button" class="btn btn-primary btn-lg"
                                            id="submitbtn">Submit</button>
                                    </div>


                                </div>
                            </div>
                        </div>

                    </div>
                </div>

            </div>
        </div>
        <!-- /Page Wrapper -->

    </div>
    <!-- /Main Wrapper -->

    <script src="/public/js/main/jquery-3.5.1.min.js"></script>

    <!-- Bootstrap Core JS -->
    <script src="/public/js/main/popper.min.js"></script>
    <script src="/public/js/main/bootstrap.min.js"></script>

    <!-- Feather Icon JS -->
    <script src="/public/js/main/feather.min.js"></script>

    <!-- Slimscroll JS -->
    <script src="/public/plugins/slimscroll/jquery.slimscroll.min.js"></script>

    <!-- Select2 JS -->
    <script src="/public/plugins/select2/js/select2.min.js"></script>

    <!-- Datepicker Core JS -->
    <script src="/public/plugins/moment/moment.min.js"></script>
    <script src="/public/js/main/bootstrap-datetimepicker.min.js"></script>

    <!-- Custom JS -->
    <script src="/public/js/main/script.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.5/firebase.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="/public/js/custom/firebase.js"></script>
    <script>
        var db = firebase.firestore()
        var storageRef = firebase.storage().ref();
      var uemail=localStorage.getItem("uemail")
        document.getElementById("submitbtn").addEventListener("click", async () => {

            var name = document.getElementById("name").value
            var number = document.getElementById("number").value
            var email = document.getElementById("email").value            
            var aadhar = document.getElementById("aadhar").files[0]
            var election = document.getElementById("election").files[0]
            var id = document.getElementById("id").files[0]
            var certificate = document.getElementById("certificate").files[0]
            var identity = document.getElementById("identity").files[0]
            var license = document.getElementById("license").files[0]
            var ration = document.getElementById("ration").files[0]
            var property = document.getElementById("property").files[0]
            var pension = document.getElementById("pension").files[0]
            var others = document.getElementById("others").files[0]
            var emailreg = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/
            if (name == "") {
                document.getElementById("fbname").style.display = "block"
                return false
            } else if (number == "") {
                document.getElementById("fbnumber").style.display = "block"
                return false
            } else if (!emailreg.test(email)) {
                document.getElementById("fbemail").style.display = "block"
                return false
            }  else if (aadhar == undefined) {
                document.getElementById("fbaadhar").style.display = "block"
                return false
            } else if (election == undefined) {
                document.getElementById("fbelection").style.display = "block"
                return false
            }else if (id == undefined) {
                document.getElementById("fbid").style.display = "block"
                return false
            }else if (certificate == undefined) {
                document.getElementById("fbcertificate").style.display = "block"
                return false
            }else if (identity == undefined) {
                document.getElementById("fbidentity").style.display = "block"
                return false
            } else if (license == undefined) {
                document.getElementById("fblicense").style.display = "block"
                return false
            }else if (ration == undefined) {
                document.getElementById("fbration").style.display = "block"
                return false
            }else if (property == undefined) {
                document.getElementById("fbproperty").style.display = "block"
                return false
            }else if (pension == undefined) {
                document.getElementById("fbpension").style.display = "block"
                return false
            }else {

                toastr["info"]("Please Wait", "File Uploading..");
				document.getElementById("submitbtn").innerHTML = " <span class='spinner-border spinner-border-sm mr-2' role='status'style='padding: 7px;' aria-hidden='true'></span>Please Wait..."

                var walletamount = new Promise((resolve, reject) => {
                    var wallet = db.collection("users").doc(uemail).collection("wallet").doc(
                        uemail)
                    wallet.get().then((
                        doc) => {
                        if (doc.data() != undefined) {
                            var useramount = doc.data().amount
                            if (useramount < 3500) {
                                console.log("please add money")
                                setTimeout(() => {
                                    resolve(0)
                                })
                            } else {
                               resolve(1)

                            }
                        } else {
                            console.log("please add money")
                            setTimeout(() => {
                                resolve(0)
                            })
                        }
                    })
                })
                var walletprice = await walletamount
                var  aadharurl, othersurl, electionurl,idurl,certificateurl,identityurl,licenseurl,rationurl,propertyurl,pensionurl
                var userid = email
                if (walletprice == 1) {
           
                    var aadharref = storageRef.child(userid + "/" + name + '/Tatkaal/aadhar/' + aadhar
                        .name);
                    await aadharref.put(aadhar).then(function (snapshot) {
                        //getting url  				
                        aadharref.getDownloadURL().then(function (url) {
                            aadharurl = url;
                            console.log(aadharurl);
                        })
                            .catch(function (error) {
                                console.log("error encountered");
                            });
                    });

                    var electionref = storageRef.child(userid + "/" + name + '/Tatkaal/election/' + election
                        .name);
                    await electionref.put(election).then(function (snapshot) {
                        //getting url  				
                        electionref.getDownloadURL().then(function (url) {
                            electionurl = url;
                            console.log(electionurl);
                        })
                            .catch(function (error) {
                                console.log("error encountered");
                            });
                    });
                    var idref = storageRef.child(userid + "/" + name + '/Tatkaal/id/' + id
                        .name);
                    await idref.put(id).then(function (snapshot) {
                        //getting url  				
                        idref.getDownloadURL().then(function (url) {
                            idurl = url;
                            console.log(idurl);
                        })
                            .catch(function (error) {
                                console.log("error encountered");
                            });
                    });
                    var certificateref = storageRef.child(userid + "/" + name + '/Tatkaal/certificate/' + certificate
                        .name);
                    await certificateref.put(certificate).then(function (snapshot) {
                        //getting url  				
                        certificateref.getDownloadURL().then(function (url) {
                            certificateurl = url;
                            console.log(certificateurl);
                        })
                            .catch(function (error) {
                                console.log("error encountered");
                            });
                    });
                    var identityref = storageRef.child(userid + "/" + name + '/Tatkaal/identity/' + identity
                        .name);
                    await identityref.put(identity).then(function (snapshot) {
                        //getting url  				
                        identityref.getDownloadURL().then(function (url) {
                            identityurl = url;
                            console.log(identityurl);
                        })
                            .catch(function (error) {
                                console.log("error encountered");
                            });
                    });
                    var licenseref = storageRef.child(userid + "/" + name + '/Tatkaal/license/' + license
                        .name);
                    await licenseref.put(license).then(function (snapshot) {
                        //getting url  				
                        licenseref.getDownloadURL().then(function (url) {
                            licenseurl = url;
                            console.log(licenseurl);
                        })
                            .catch(function (error) {
                                console.log("error encountered");
                            });
                    });
                    var rationref = storageRef.child(userid + "/" + name + '/Tatkaal/ration/' + ration
                        .name);
                    await rationref.put(ration).then(function (snapshot) {
                        //getting url  				
                        rationref.getDownloadURL().then(function (url) {
                            rationurl = url;
                            console.log(rationurl);
                        })
                            .catch(function (error) {
                                console.log("error encountered");
                            });
                    });
                    var propertyref = storageRef.child(userid + "/" + name + '/Tatkaal/property/' + property
                        .name);
                    await propertyref.put(property).then(function (snapshot) {
                        //getting url  				
                        propertyref.getDownloadURL().then(function (url) {
                            propertyurl = url;
                            console.log(propertyurl);
                        })
                            .catch(function (error) {
                                console.log("error encountered");
                            });
                    });
                    var pensionref = storageRef.child(userid + "/" + name + '/Tatkaal/pension/' + pension
                        .name);
                    await pensionref.put(pension).then(function (snapshot) {
                        //getting url  				
                        pensionref.getDownloadURL().then(function (url) {
                            pensionurl = url;
                            console.log(pensionurl);
                        })
                            .catch(function (error) {
                                console.log("error encountered");
                            });
                    });
               if(others!=undefined){
                    var otherref = storageRef.child(userid + "/" + name + '/Tatkaal/other/' + others
                        .name);
                    await otherref.put(others).then(function (snapshot) {
                        //getting url  				
                        otherref.getDownloadURL().then(function (url) {
                            othersurl = url;
                            console.log(othersurl);
                        })
                            .catch(function (error) {
                                console.log("error encountered");
                            });
                    });
                }else{
                    othersurl="none"
                }
                    setTimeout(() => {
                        $.ajax({
                            method: "POST",
                            url: "/passport/tatkal",
                            data: {
                                name: name,
                                number: number,
                                email: email,
                                Certificate: "Tatkal",
                                Certificatename: "Tatkal",
                                aadhar:aadharurl,
                                election:electionurl,
                                id:idurl,
                                certificate:certificateurl,
                                identity:identityurl,
                                license:licenseurl,
                                ration:rationurl,
                                property:propertyurl,
                                pension:pensionurl,
                                uemail:uemail
                            },
                            success: (res) => {
                                if (res.status != undefined) {                                    
                                    var wallet = db.collection("users").doc(uemail).collection("wallet").doc(uemail)
                                    var myamount = wallet.get().then((doc) => {
                                        var useramount = doc.data().amount
                                        wallet.update({
                                            amount: Number(useramount) - Number(3600)
                                        }).then(() => {                                            
                                            db.collection("users").doc(uemail).collection("wallethistory").doc().set({
                                                amount: 3600,
                                                Certificatename: "Tatkal Certificate"
                                            }).then(() => {
                                                db.collection("users").doc(uemail).get().then((docss) => {
                                                    db.collection("wallethistory").doc().set({
                                                        amount: 3600,
                                                        Certificatename: "Tatkal Certificate",
                                                        date: cdate,
                                                        name: docss.data().uname
                                                    })
                                                })
                                                toastr["success"]("Success", "Certificate Upload Successfully..");//successfully
                                                setTimeout(() => { window.location.reload() }, 2000)
                                            })
                                        })
                                    })
                                }
						}
					})
				}, 3000)

			
			} else {
				toastr["error"]("Low Balance", "Please Add Money..");
			}
            }
        })
    </script>
</body>

<!-- Mirrored from kanakku.dreamguystech.com/template-html/form-basic-inputs.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 02 Feb 2021 23:21:44 GMT -->

</html>